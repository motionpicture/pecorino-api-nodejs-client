/**
 * 取引履歴検索サンプル
 * @ignore
 */

const moment = require('moment');
const util = require('util');
const pecorinoapi = require('../lib/');

const accessToken = 'eyJraWQiOiI0eVpocWlFZlFRVEVmSTNERlA1ZjBWQXpwazFLekFBa3RQd2haSGZHdzBzPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJhZWJhZjU3My05OGMxLTRjZWEtODRiZi1lMjBlYmRjNjg2OWEiLCJ0b2tlbl91c2UiOiJhY2Nlc3MiLCJzY29wZSI6ImF3cy5jb2duaXRvLnNpZ25pbi51c2VyLmFkbWluIG9wZW5pZCBwcm9maWxlIGh0dHBzOlwvXC9zc2t0cy1hcGktZGV2ZWxvcG1lbnQuYXp1cmV3ZWJzaXRlcy5uZXRcL3BsYWNlcy5yZWFkLW9ubHkgaHR0cHM6XC9cL3Nza3RzLWFwaS1kZXZlbG9wbWVudC5henVyZXdlYnNpdGVzLm5ldFwvcGVvcGxlLmNyZWRpdENhcmRzLnJlYWQtb25seSBodHRwczpcL1wvcGVjb3Jpbm8tYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC9hY2NvdW50cy5hY3Rpb25zLnJlYWQtb25seSBodHRwczpcL1wvc3NrdHMtYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC9wZW9wbGUuY29udGFjdHMgaHR0cHM6XC9cL3Nza3RzLWFwaS1kZXZlbG9wbWVudC5henVyZXdlYnNpdGVzLm5ldFwvcGVvcGxlLmNvbnRhY3RzLnJlYWQtb25seSBodHRwczpcL1wvc3NrdHMtYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC9wZW9wbGUub3duZXJzaGlwSW5mb3MgaHR0cHM6XC9cL3Nza3RzLWFwaS1kZXZlbG9wbWVudC5henVyZXdlYnNpdGVzLm5ldFwvcGVvcGxlLm93bmVyc2hpcEluZm9zLnJlYWQtb25seSBodHRwczpcL1wvcGVjb3Jpbm8tYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC90cmFuc2FjdGlvbnMgcGhvbmUgaHR0cHM6XC9cL3Nza3RzLWFwaS1kZXZlbG9wbWVudC5henVyZXdlYnNpdGVzLm5ldFwvZXZlbnRzLnJlYWQtb25seSBodHRwczpcL1wvc3NrdHMtYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC9vcmdhbml6YXRpb25zLnJlYWQtb25seSBodHRwczpcL1wvc3NrdHMtYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC9vcmRlcnMucmVhZC1vbmx5IGh0dHBzOlwvXC9zc2t0cy1hcGktZGV2ZWxvcG1lbnQuYXp1cmV3ZWJzaXRlcy5uZXRcL3Blb3BsZS5jcmVkaXRDYXJkcyBodHRwczpcL1wvc3NrdHMtYXBpLWRldmVsb3BtZW50LmF6dXJld2Vic2l0ZXMubmV0XC90cmFuc2FjdGlvbnMgZW1haWwiLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAuYXAtbm9ydGhlYXN0LTEuYW1hem9uYXdzLmNvbVwvYXAtbm9ydGhlYXN0LTFfbG5xVWV2aVhqIiwiZXhwIjoxNTE3MzE1MTYxLCJpYXQiOjE1MTczMTE1NjEsInZlcnNpb24iOjIsImp0aSI6ImVjYzhkY2UzLWFmOTgtNGMwNi05MDYwLWYwN2UyNDM4ODhhZSIsImNsaWVudF9pZCI6Iml0MjA3b2VhdGJkN2ZqZGN2c2Yzcm1za3UiLCJ1c2VybmFtZSI6Imlsb3ZlZ2FkZCJ9.Ru9YRQ75l_QJM0Me7LQMwJky-oUZa3lDOMTDeky4bP-OyG7DycEizq_dTVrrR5nslCMSdh4jiSKQLAD6UteQp0KHpbuhV5pGSUPCrwZdh2CIgGqgSx-Zp9QWFd8C4lD5RhBGhVYLGGgZOAN034jq9EFsKyEkNCjcwyr1uogKYtveqBL_4MVP3ZzvkhwpBVjMZ7AIAJ7uUyPRk3KPTdvqXXUfxu5IDt7h4hR2_7LtHc2eVwvpfNRPBZo_uQUs5YTYcbZ4dOe3nX8RqGsPsUg9Net2QJyFWWzpyPdwyl_BPr332dhgHKanKiYB2o-31OtSeHTr7nZY4XwEa3kqy22IAA';

const oauth2client = new pecorinoapi.auth.OAuth2({
    domain: process.env.TEST_AUTHORIZE_SERVER_DOMAIN
});
oauth2client.setCredentials({
    access_token: accessToken
});

const accountService = new pecorinoapi.service.Account({
    endpoint: process.env.TEST_API_ENDPOINT,
    auth: oauth2client
});

async function main() {
    const actions = await accountService.searchTradeActions({});
    console.log(actions.map((a) => `${moment(a.endDate).format('YYYY-MM-DD HH:mm')} ${a.typeOf} ${a.object.price} ${a.recipient.name}`).join('\n'));
}

main().then(() => {
    console.log('main processed.');
}).catch(console.error);
